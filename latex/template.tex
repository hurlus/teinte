% memoir and koma does not work well for section titles and columns, waiting for LaTeX3
\documentclass[10pt,twoside,french]{book}
\makeatletter % @@@

% before geometry and cols
\usepackage{xcolor}
\definecolor{shadecolor}{gray}{0.95}
\definecolor{bghi}{gray}{0.5}

% specific A4
\usepackage{multicol}
\usepackage[%
  a4paper,
  outer=1cm,
  inner=2cm,
  tmargin=1.5cm,
  bmargin=1.5cm,
]{geometry}
\setlength{\columnsep}{2cm}
\setlength{\columnseprule}{0.2pt}
\def{\columnseprulecolor}{\gray}


% latex packages and their configuration
% \usepackage{colortbl} % table colors
\usepackage{tcolorbox}
\usepackage{etoolbox}
\usepackage{wrapfig}
\RequirePackage{fix-cm}
\usepackage{ifxetex}

% indents
\usepackage[%
  indentfirst=false,
  rightmargin=0pt,
  leftmargin=1.5em
]{quoting}
\setlength{\parindent}{1.5em}
\setlength{\parskip}{0pt}


\usepackage{framed}
\usepackage{lettrine}
\usepackage{longtable}
% \usepackage[normalem]{ulem} % Package multicol Warning: May not work
\usepackage{graphicx}
\usepackage{marginnote}

% conditional packages (xetex)
\IfFileExists{xcolor.sty}%
  {\RequirePackage{xcolor}}%
  {\RequirePackage{color}}
\ifxetex
  \usepackage{fontspec}
  \defaultfontfeatures{Scale = MatchLowercase}
  \setmainfont[%
    Scale=1.05,
    Ligatures={Common, TeX},
    % UprightFont={* Light},
    BoldFont={* SemiBold},
    ItalicFont={* SemiBold Italic}
  ]{Open Sans}
  \setsansfont{Bitter} 
  \usepackage{xunicode}
  \defaultfontfeatures{Ligatures={TeX}}
  \usepackage{polyglossia} % non-break space french punct
  \setmainlanguage{french}
  \catcode`⃥=\active \def⃥{\textbackslash}
  \catcode`❴=\active \def❴{\{}
  \catcode`❵=\active \def❵{\}}
  \setmonofont{DejaVu Sans Mono}
\else
  \IfFileExists{utf8x.def}%
   {\usepackage[utf8x]{inputenc}
      \PrerenderUnicode{–}
    }%
   {\usepackage[utf8]{inputenc}}
  \usepackage{babel}
  \usepackage[T1]{fontenc}
  \usepackage{float}
  \usepackage[]{ucs}
  \uc@dclc{8421}{default}{\textbackslash }
  \uc@dclc{10100}{default}{\{}
  \uc@dclc{10101}{default}{\}}
  \uc@dclc{8491}{default}{\AA{}}
  \uc@dclc{8239}{default}{\,}
  \uc@dclc{20154}{default}{ }
  \uc@dclc{10148}{default}{>}
  \def\textschwa{\rotatebox{-90}{e}}
  \def\textJapanese{}
  \def\textChinese{}
  \IfFileExists{tipa.sty}{\usepackage{tipa}}{}
  \usepackage{times}
\fi

\newcommand*\showfontsize{\f@size{} point}

\def\exampleFont{\ttfamily\small}
\DeclareTextSymbol{\textpi}{OML}{25}
\usepackage{relsize}
\RequirePackage{array}
\def\@testpach{\@chclass
 \ifnum \@lastchclass=6 \@ne \@chnum \@ne \else
  \ifnum \@lastchclass=7 5 \else
   \ifnum \@lastchclass=8 \tw@ \else
    \ifnum \@lastchclass=9 \thr@@
   \else \z@
   \ifnum \@lastchclass = 10 \else
   \edef\@nextchar{\expandafter\string\@nextchar}%
   \@chnum
   \if \@nextchar c\z@ \else
    \if \@nextchar l\@ne \else
     \if \@nextchar r\tw@ \else
   \z@ \@chclass
   \if\@nextchar |\@ne \else
    \if \@nextchar !6 \else
     \if \@nextchar @7 \else
      \if \@nextchar (8 \else
       \if \@nextchar )9 \else
  10
  \@chnum
  \if \@nextchar m\thr@@\else
   \if \@nextchar p4 \else
    \if \@nextchar b5 \else
   \z@ \@chclass \z@ \@preamerr \z@ \fi \fi \fi \fi
   \fi \fi  \fi  \fi  \fi  \fi  \fi \fi \fi \fi \fi \fi}
\gdef\arraybackslash{\let\\=\@arraycr}
\def\@textsubscript#1{{\m@th\ensuremath{_{\mbox{\fontsize\sf@size\z@#1}}}}}
\def\Panel#1#2#3#4{\multicolumn{#3}{){\columncolor{#2}}#4}{#1}}

% TEI commands
\def\abbr{}
\def\corr{}
\def\expan{}
\def\gap{}
\def\orig{}
\def\reg{}
\def\ref{}
\def\sic{}
\def\persName{}\def\name{}
\def\placeName{}
\def\orgName{}
\def\textcal#1{{\fontspec{Lucida Calligraphy}#1}}
\def\textgothic#1{{\fontspec{Lucida Blackletter}#1}}
\def\textlarge#1{{\large #1}}
\def\textoverbar#1{\ensuremath{\overline{#1}}}
\def\textquoted#1{‘#1’}
\def\textsmall#1{{\small #1}}
\def\textsubscript#1{\@textsubscript{\selectfont#1}}
\def\textxi{\ensuremath{\xi}}
\def\titlem{\itshape}
\newenvironment{biblfree}{}{\ifvmode\par\fi }
\newenvironment{bibl}{}{}
\newenvironment{byline}{\vskip6pt\itshape\fontsize{16pt}{18pt}\selectfont}{\par }
\newenvironment{citbibl}{}{\ifvmode\par\fi }
\newenvironment{docAuthor}{\ifvmode\vskip4pt\fontsize{16pt}{18pt}\selectfont\fi\itshape}{\ifvmode\par\fi }
\newenvironment{docDate}{}{\ifvmode\par\fi }
\newenvironment{docImprint}{\vskip 6pt}{\ifvmode\par\fi }
\newenvironment{docTitle}{\vskip6pt\bfseries\fontsize{18pt}{22pt}\selectfont}{\par }
\newenvironment{msHead}{\vskip 6pt}{\par}
\newenvironment{msItem}{\vskip 6pt}{\par}
\newenvironment{rubric}{}{}
\newenvironment{titlePart}{}{\par }
\newenvironment{blabel}{\begin{center}\begin{bfseries}}{\end{bfseries}\end{center}}


\newcolumntype{L}[1]{){\raggedright\arraybackslash}p{#1}}
\newcolumntype{C}[1]{){\centering\arraybackslash}p{#1}}
\newcolumntype{R}[1]{){\raggedleft\arraybackslash}p{#1}}
\newcolumntype{P}[1]{){\arraybackslash}p{#1}}
\newcolumntype{B}[1]{){\arraybackslash}b{#1}}
\newcolumntype{M}[1]{){\arraybackslash}m{#1}}
\definecolor{label}{gray}{0.75}
\def\unusedattribute#1{\sout{\textcolor{label}{#1}}}
\DeclareRobustCommand*{\xref}{\hyper@normalise\xref@}
\def\xref@#1#2{\hyper@linkurl{#2}{#1}}
\begingroup
\catcode`\_=\active
\gdef_#1{\ensuremath{\sb{\mathrm{#1}}}}
\endgroup
\mathcode`\_=\string"8000
\catcode`\_=12\relax


\renewcommand{\@cite}[1]{#1}

% footnotes
\renewcommand*{\marginfont}{\itshape\footnotesize}
\patchcmd{\@footnotetext}{\footnotesize}{\small}{}{}
\renewcommand\footnoterule{\vspace*{0.3cm}\hrule height 0.1pt width 3cm \vspace*{0.3cm}}

\def\Gin@extensions{.pdf,.png,.jpg,.mps,.tif}




\def\@pnumwidth{1.55em}
\def\@tocrmarg {2.55em}
\def\@dotsep{4.5}
\clubpenalty=8000
\emergencystretch 3em
\hbadness=4000
\hyphenpenalty=400
\pretolerance=750
\tolerance=2000
\vbadness=4000
\widowpenalty=10000

\renewcommand\chapter{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \thispagestyle{plain} % no fancy
  \global\@topnum\z@
  \@afterindentfalse
  \secdef\@chapter\@schapter
}
\renewcommand\section{\@startsection{section}{1}{\z@}%
     {-1.75ex \@plus -0.5ex \@minus -.2ex}%
     {0.5ex \@plus .2ex}%
     {\reset@font\Large\bfseries}
}
\renewcommand\subsection{\@startsection{subsection}{2}{\z@}%
     {-1.75ex\@plus -0.5ex \@minus- .2ex}%
     {0.5ex \@plus .2ex}%
     {\reset@font\Large}
}
\renewcommand\subsubsection{\@startsection{subsubsection}{3}{\z@}%
     {-1.5ex\@plus -0.35ex \@minus -.2ex}%
     {0.5ex \@plus .2ex}%
     {\reset@font\large}
}
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
     {-1ex \@plus-0.35ex \@minus -0.2ex}%
     {0.5ex \@plus .2ex}%
     {\reset@font\normalsize}
}
\renewcommand\subparagraph{\@startsection{subparagraph}{5}{\parindent}%
     {1.5ex \@plus1ex \@minus .2ex}%
     {-1em}%
     {\reset@font\normalsize\bfseries}
}

\setcounter{secnumdepth}{-2} % no counters for hierarchy titles
\setcounter{tocdepth}{5}

\usepackage[explicit]{titlesec} % NO implicit !
\tcbuselibrary{skins}
\usetikzlibrary{calc}
\usetikzlibrary{shadows}
\titleformat{name=\chapter}[display]
  {\Large\bfseries\color{bghi}}
  {\thechapter}
  {35pt}
  {#1} % explicit
  [\vspace{0.1ex}{\titlerule[0.1pt]}]
\titlespacing*{\chapter}{0pt}{-35pt}{0pt}[0pt]

\newtcolorbox{sectionbox}{%
  enhanced,
  width=\linewidth,
  colback=white,
  % coltext=white,
  colframe=black,
  frame hidden,
  boxrule=0.1pt,
  left=3pt,
  right=3pt,
  top=0pt,
  bottom=0pt,
  halign=flush right,
  lifted shadow={-0.3pt}{-2mm}{3mm}{0.1mm}{bghi}
}
\titleformat{name=\section}[hang]
  {\large\bfseries} % filright ?
  {} % \thesection
  {}
% {\colorbox{bghi}{\parbox{\dimexpr\linewidth-2\fboxsep}{#1}}}
  {\begin{sectionbox}{#1}\end{sectionbox}}

\titlespacing{\section}{0pt}{1.5em}{-10pt}{} % done by colorbox

\def\tableofcontents{\subsection{\contentsname}\@starttoc{toc}} % title of the toc in the toc

\newenvironment{bibitemlist}[1]{%
   \list{\@biblabel{\@arabic\c@enumiv}}%
       {\settowidth\labelwidth{\@biblabel{#1}}%
        \leftmargin\labelwidth
        \advance\leftmargin\labelsep
        \@openbib@code
        \usecounter{enumiv}%
        \let\p@enumiv\@empty
        \renewcommand\theenumiv{\@arabic\c@enumiv}%
	}%
  \sloppy
  \clubpenalty4000
  \@clubpenalty \clubpenalty
  \widowpenalty4000%
  \sfcode`\.\@m}%
  {\def\@noitemerr
    {\@latex@warning{Empty `bibitemlist' environment}}%
    \endlist}


\def\Panel#1#2#3#4{\multicolumn{#3}{){\columncolor{#2}}#4}{#1}}
\newenvironment{reflist}{%
  \begin{raggedright}\begin{list}{}
  {%
   \setlength{\topsep}{0pt}%
   \setlength{\rightmargin}{0.25in}%
   \setlength{\itemsep}{0pt}%
   \setlength{\itemindent}{0pt}%
   \setlength{\parskip}{0pt}%
   \setlength{\parsep}{2pt}%
   \def\makelabel##1{\itshape ##1}}%
  }
  {\end{list}\end{raggedright}}
\newenvironment{sansreflist}{%
  \begin{raggedright}\begin{list}{}
  {%
   \setlength{\topsep}{0pt}%
   \setlength{\rightmargin}{0.25in}%
   \setlength{\itemindent}{0pt}%
   \setlength{\parskip}{0pt}%
   \setlength{\itemsep}{0pt}%
   \setlength{\parsep}{2pt}%
   \def\makelabel##1{\upshape\sffamily ##1}}%
  }
  {\end{list}\end{raggedright}}
\newenvironment{specHead}[2]%
 {\vspace{20pt}\hrule\vspace{10pt}%
  \phantomsection\label{#1}\markright{#2}%

  \pdfbookmark[2]{#2}{#1}%
  \hspace{-0.75in}{\bfseries\fontsize{16pt}{18pt}\selectfont#2}%
  }{}
      \def\TheFullDate{2021 (revised: 2021-05-24T17:10:30Z)}

% For title page
\def\TheID{Victor Hugo, 1852, Napoléon le petit}
\def\TheDate{1852}
\title{Napoléon le petit}
\author{Victor Hugo}

\newcommand*{\cleartoleftpage}{%
  \clearpage
    \if@twoside
    \ifodd\c@page
      \hbox{}\newpage
      \if@twocolumn
        \hbox{}\newpage
      \fi
    \fi
  \fi
}


\thispagestyle{empty}
\markright{\@title}\markboth{\@title}{\@author}
\renewcommand\small{\@setfontsize\small{9pt}{11pt}\abovedisplayskip 8.5\p@ plus3\p@ minus4\p@
\belowdisplayskip \abovedisplayskip
\abovedisplayshortskip \z@ plus2\p@
\belowdisplayshortskip 4\p@ plus2\p@ minus2\p@
\def\@listi{\leftmargin\leftmargini
               \topsep 2\p@ plus1\p@ minus1\p@
               \parsep 2\p@ plus\p@ minus\p@
               \itemsep 1pt}
}


\usepackage{fancyvrb}
\usepackage{fancyhdr}
\usepackage[fit]{truncate}
\fvset{frame=single,numberblanklines=false,xleftmargin=5mm,xrightmargin=5mm} % verbatim code
% redefine plain
\fancypagestyle{plain}{%
  \fancyhf{}% clear all header and footer fields
  \fancyfoot[RO,LE]{\thepage} % except the center
  \renewcommand{\headrulewidth}{0pt}%
  \renewcommand{\footrulewidth}{0pt}%
}
\pagestyle{fancy}
\fancyhf{} 
\setlength{\headheight}{14pt}
\renewcommand{\headrulewidth}{0.1pt}
\fancyhead{} % reset head
\fancyfoot{} % reset foot
\fancyhead[RO,RE]{\color{bghi}\nouppercase{\truncate{0.5\headwidth}{\leftmark}}} % Chapter title
\fancyhead[CO,CE]{\thepage}
\fancyhead[LO,LE]{\color{bghi}\nouppercase{\truncate{0.5\headwidth}{\TheID}}} % Chapter title
% last page hasn't work
% \fancypagestyle{plain}{\fancyhead{}\renewcommand{\headrulewidth}{0pt}}

\usepackage{pgfornament}


\usepackage{hyperref} % supposed to be the last one
\hypersetup{
  % pdftex, % no effect
  pdftitle={Victor Hugo, 1852, Napoléon le petit},
  % pdfauthor={Your name here},
  % pdfsubject={Your subject here},
  % pdfkeywords={keyword1, keyword2},
  bookmarksnumbered=true,
  bookmarksopen=true,
  bookmarksopenlevel=1,
  pdfstartview=Fit,
  % linktocpage=true, % toc, link only on page no 
  pdfpagemode=UseOutlines,    % pdf toc
  % pdfpagelayout=TwoPageRight,
  citebordercolor=0.75 0.75 0.75,
  linkbordercolor=0.75 0.75 0.75,
  urlbordercolor=0.75 0.75 0.75,
  colorlinks=true,
  allcolors=black,
}
\hyperbaseurl{}
\usepackage{hypcap}
\usepackage{bookmark}

\makeatother % @@@

\begin{document}

% \raggedbottom % may correct warning: Underfull \vbox (badness 10000)

\makeatletter
\noindent\parbox[b]{.75\textwidth}{\fontsize{13pt}{15pt}\bfseries\raggedright\selectfont\@author{, }\TheDate}
\vskip10pt
\par\noindent{\fontsize{19pt}{21pt}\itshape\raggedright\selectfont\@title}
\vspace{0pt}
\makeatother
\par\noindent\rule{\textwidth}{0.4pt}
\vspace{15pt}
\let\tabcellsep& 

\begin{multicols}{2}
\tableofcontents
\end{multicols}

%tei%

\end{document}

